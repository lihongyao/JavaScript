# æ¦‚è¿°

[DOM](https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model)ï¼ˆ**D**ocument **O**bject **M**odelï¼Œå³ æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰**æ˜¯ç½‘é¡µçš„ç¼–ç¨‹æ¥å£**ï¼Œå®ƒå°† HTML / XML è§£æä¸º **ç»“æ„åŒ–çš„å¯¹è±¡**ï¼Œä»è€Œå…è®¸ JavaScript å¯¹ç½‘é¡µè¿›è¡Œæ“ä½œï¼ˆå¦‚å¢åˆ æ”¹æŸ¥ï¼‰ã€‚

æµè§ˆå™¨æ ¹æ® DOM è§„èŒƒï¼Œå°†æ–‡æ¡£è§£ææˆ **æ ‘çŠ¶ç»“æ„ï¼ˆDOM æ ‘ï¼‰**ï¼Œå…¶ä¸­æ¯ä¸ªéƒ¨åˆ†ï¼ˆæ ‡ç­¾ã€å±æ€§ã€æ–‡æœ¬ç­‰ï¼‰éƒ½æ˜¯ **èŠ‚ç‚¹ï¼ˆNodeï¼‰**ã€‚æ‰€æœ‰èŠ‚ç‚¹éƒ½éµå¾ªç»Ÿä¸€çš„ APIï¼Œå¯ä¾› JavaScript æ“ä½œã€‚

> **æ³¨æ„**ï¼šDOM å¹¶ä¸å±äº JavaScriptï¼Œä½† JS æ˜¯æœ€å¸¸ç”¨äºæ“ä½œ DOM çš„è¯­è¨€ã€‚

# èŠ‚ç‚¹

## æ¦‚å¿µ

DOM çš„æœ€å°ç»„æˆå•ä½å«åš **èŠ‚ç‚¹**ï¼ˆ`Node`ï¼‰ã€‚æ–‡æ¡£çš„æ ‘å½¢ç»“æ„ï¼ˆDOMæ ‘ï¼‰ï¼Œå°±æ˜¯ç”±å„ç§ä¸åŒç±»å‹çš„èŠ‚ç‚¹ç»„æˆã€‚

èŠ‚ç‚¹çš„ç±»å‹æœ‰ä¸ƒç§ï¼š

- `Document`ï¼š**æ–‡æ¡£èŠ‚ç‚¹**ï¼Œä»£è¡¨æ•´ä¸ªç½‘é¡µï¼ˆDOM æ ‘çš„æ ¹èŠ‚ç‚¹ï¼‰
- `DocumentType`ï¼š**æ–‡æ¡£ç±»å‹èŠ‚ç‚¹ç±»å‹** ï¼šå¦‚ \<!DOCTYPE html>
- `Element`ï¼š**å…ƒç´ èŠ‚ç‚¹**ï¼Œç½‘é¡µçš„ HTML æ ‡ç­¾ï¼Œå¦‚ \<body>ã€\<a>ã€‚
- `Attribute`ï¼š**å±æ€§èŠ‚ç‚¹**ï¼Œå…ƒç´ çš„å±æ€§ï¼Œå¦‚ class="right"ï¼ˆç°ä»£ JS ä¸»è¦é€šè¿‡ element.getAttribute() æ“ä½œï¼‰ã€‚
- `Text`ï¼š**æ–‡æœ¬èŠ‚ç‚¹** ï¼Œå…ƒç´ æˆ–å±æ€§ä¸­çš„æ–‡æœ¬å†…å®¹
- `Comment`ï¼š**æ³¨é‡ŠèŠ‚ç‚¹** ï¼ŒTML ä¸­çš„ \<!-- æ³¨é‡Š -->
- `DocumentFragment`ï¼šè½»é‡çº§çš„ DOM ç»“æ„ï¼Œå¸¸ç”¨äºæ‰¹é‡æ’å…¥èŠ‚ç‚¹ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚

> æç¤ºï¼šè¿™ä¸ƒç§èŠ‚ç‚¹éƒ½å±äºæµè§ˆå™¨åŸç”Ÿæä¾›çš„èŠ‚ç‚¹å¯¹è±¡çš„æ´¾ç”Ÿå¯¹è±¡ï¼Œå…·æœ‰ä¸€äº›å…±åŒçš„å±æ€§å’Œæ–¹æ³•ã€‚

æˆ‘ä»¬å¯é€šè¿‡ `nodeName` å’Œ `nodeType` å±æ€§åˆ¤æ–­å¯¹åº”èŠ‚ç‚¹çš„åç§°å’Œç±»å‹ã€‚

| ç±»å‹                     | æè¿°     | `nodeName`                   | `nodeType` |
| ------------------------ | -------- | ---------------------------- | ---------- |
| `ELEMENT_NODE` *         | å…ƒç´ èŠ‚ç‚¹ | å¤§å†™çš„HTMLæ ‡ç­¾å             | 1          |
| `ATTRIBUTE_NODE` *       | å±æ€§èŠ‚ç‚¹ | ç­‰åŒäº `Attr.name`ï¼ˆå±æ€§åï¼‰ | 2          |
| `TEXT_NODE` *            | æ–‡æœ¬èŠ‚ç‚¹ | `#text`                      | 3          |
| `COMMENT_NODE`           | æ³¨é‡ŠèŠ‚ç‚¹ | `#comment`                   | 8          |
| `DOCUMENT_NODE`          | æ–‡æ¡£èŠ‚ç‚¹ | `#document`                  | 9          |
| `DOCUMENT_FRAGMENT_NODE` |          | `#document-fragment`         | 11         |
| `DOCUMENT_TYPE_NODE`     |          | ç­‰åŒäº `DocumentType.name`   | 10         |

> æç¤ºï¼šæœ¬èŠ‚çŸ¥è¯†ç‚¹ä½œä¸ºäº†è§£å³å¯ã€‚

##  èŠ‚ç‚¹æ ‘

ä¸€ä¸ªæ–‡æ¡£çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ŒæŒ‰ç…§æ‰€åœ¨çš„å±‚çº§ï¼Œå¯ä»¥æŠ½è±¡æˆä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œè¿™ç§æ ‘çŠ¶ç»“æ„å°±æ˜¯ **DOMæ ‘**ã€‚

æœ€é¡¶å±‚çš„èŠ‚ç‚¹å°±æ˜¯ `document` èŠ‚ç‚¹ï¼Œå®ƒä»£è¡¨äº†æ•´ä¸ªæ–‡æ¡£ã€‚æ–‡æ¡£é‡Œé¢æœ€é«˜ä¸€å±‚çš„ `HTML` æ ‡ç­¾ï¼Œä¸€èˆ¬æ˜¯ `<html>`ï¼Œå®ƒæ„æˆæ ‘ç»“æ„çš„æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–HTMLæ ‡ç­¾èŠ‚ç‚¹éƒ½æ˜¯å®ƒçš„ä¸‹çº§ã€‚

é™¤äº†æ ¹èŠ‚ç‚¹ä»¥å¤–ï¼Œå…¶ä»–èŠ‚ç‚¹å¯¹äºå‘¨å›´çš„èŠ‚ç‚¹éƒ½å­˜åœ¨ä¸¤ç§å…³ç³»ï¼š

- çˆ¶å­å…³ç³»
- å…„å¼Ÿå…³ç³»

ç¤ºä¾‹ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <title>DOM Tutorial</title>
  </head>
  <body>
    <h1>DOMs</h1>
    <a href="#">ä¸»é¡µ</a>
  </body>
</html>
```

ä¸Šè¿°ä»£ç çš„èŠ‚ç‚¹æ ‘æ¨¡å‹ï¼š

![](IMGS/nodeTree.png)

## èŠ‚ç‚¹é›†åˆ

èŠ‚ç‚¹éƒ½æ˜¯å•ä¸ªå¯¹è±¡ï¼Œæœ‰æ—¶ä¼šéœ€è¦ä¸€ç§æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿå®¹çº³å¤šä¸ªèŠ‚ç‚¹ã€‚DOMæä¾›ä¸¤ç§é›†åˆå¯¹è±¡ï¼Œç”¨äºå®ç°è¿™ç§èŠ‚ç‚¹çš„é›†åˆï¼š

- `NodeList`
- `HTMLCollection`

è®¿é—®é›†åˆæˆå‘˜å¯é€šè¿‡ `ä¸‹æ ‡` æˆ– `.item(index)` è·å–ã€‚

> æç¤ºï¼š`NodeList` / `HTMLCollection` å±äº **ç±»ä¼¼æ•°ç»„** å¯¹è±¡ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨æ•°ç»„æ–¹æ³•ï¼Œå¦‚æœè¦é€šè¿‡æ•°ç»„æ–¹æ³•æ¥éå†èŠ‚ç‚¹é›†åˆï¼Œä½ éœ€è¦å°†å®ƒä»¬è½¬æ¢ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

# èŠ‚ç‚¹æŸ¥è¯¢

ä¸ºäº†ä¾¿äºæ¼”ç¤ºåé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨ `<body>`æ ‡ç­¾ä¸­æ’å…¥ä»¥ä¸‹å†…å®¹ï¼š

```html
<div id="company">æˆéƒ½å“ˆæˆ³æˆ³ç§‘æŠ€æœ‰é™å…¬å¸</div>
<ul class="departments">
  <li>æ•™å­¦éƒ¨</li>
  <li>æ•™åŠ¡éƒ¨</li>
  <li>å¸‚åœºéƒ¨</li>
  <li>å’¨è¯¢éƒ¨</li>
  <li>è¡Œæ”¿éƒ¨</li>
  <li>è´¢åŠ¡éƒ¨</li>
</ul>
<div name="address">æˆéƒ½å¸‚é«˜æ–°åŒºæ–°å·ç§‘æŠ€å›­AåŒº</div>
```

## ç›´æ¥æŸ¥æ‰¾ *

```js
// 1. æ ¹æ®IDæŸ¥æ‰¾
document.getElementById("company"); 
// 2. æ ¹æ®nameå±æ€§æŸ¥æ‰¾
document.getElementsByName("address");
// 3. æ ¹æ®ç±»åæŸ¥æ‰¾
document.getElementsByClassName("departments");
// 4. æ ¹æ®æ ‡ç­¾åæŸ¥æ‰¾
document.getElementsByTagName("li");
// 5. æ ¹æ®CSSé€‰æ‹©å™¨æŸ¥æ‰¾
document.querySelector("#company"); *
document.querySelectorAll(".departments li"); *
```

## é—´æ¥æŸ¥æ‰¾ *

é€šè¿‡å·²æ‰¾åˆ°çš„å…¶ä»–æ ‡ç­¾æ¥æŸ¥æ‰¾ã€‚

```js
// è·å–å‚ç…§èŠ‚ç‚¹
p
// 1. è·å–ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹
list.previousElementSibling;
list.previousSibling
// 2. è·å–ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹
list.nextElementSibling
list.nextSibling
// 3. è·å–çˆ¶èŠ‚ç‚¹
list.parentElement
list.parentNode
// 4. è·å–æ‰€æœ‰å­èŠ‚ç‚¹
list.children   // â†’ è·å–æ‰€æœ‰å…ƒç´ å­èŠ‚ç‚¹
list.firstElementChild // â†’ è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å­èŠ‚ç‚¹
list.lastElementChild) // â†’ è·å–æœ€åä¸€ä¸ªå…ƒç´ å­èŠ‚ç‚¹
list.childElementCount // â†’ è·å–å­èŠ‚ç‚¹çš„ä¸ªæ•°
// 5. è·å–ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
list.firstElementChild
// 5. è·å–æœ€åä¸€ä¸ªå­èŠ‚ç‚¹
list.lastElementChild
```

## å…¶ä»–æŸ¥è¯¢

```js
// 01. æŸ¥æ‰¾æ–‡æ¡£ç±»å‹
document.doctype
// 02. æŸ¥æ‰¾æ ¹èŠ‚ç‚¹
document.documentElement
// 03. æŸ¥æ‰¾Windowå¯¹è±¡
document.defaultView
// 04. æŸ¥æ‰¾headå…ƒç´ 
document.head
// 05. æŸ¥æ‰¾bodyå…ƒç´ 
document.body
// 06. æŸ¥è¯¢é¡µé¢ä¸­æ­£åœ¨è·å–ç„¦ç‚¹çš„å…ƒç´ 
document.activeElement
// 07. è·å–é¡µé¢æ‰€æœ‰çš„<a>
document.links
// 08. è·å–é¡µé¢æ‰€æœ‰çš„<form>
document.forms
// 09. è·å–é¡µé¢æ‰€æœ‰çš„<img>
document.images
// 10. è·å–é¡µé¢æ‰€æœ‰çš„<script>
document.scripts
// 11. è·å–é¡µé¢æ‰€æœ‰çš„<link>
document.styleSheets
// 12. è·å–é¡µé¢æ‰€æœ‰çš„<embeds>
document.embeds
// 13. è·å–/è®¾ç½®ç½‘é¡µæ ‡é¢˜
document.title *
```

# èŠ‚ç‚¹æ“ä½œ *

## åˆ›å»ºèŠ‚ç‚¹

```js
// 01. åˆ›å»ºå…ƒç´ èŠ‚ç‚¹
document.createElement(tagName);
// 02. åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹
document.createTextNode(content)
// 03. åˆ›å»ºå±æ€§èŠ‚ç‚¹
document.createAttribute(attrName);
// 04. åˆ›å»ºæ–‡æœ¬ç‰‡æ®µ
document.createDocumentFragment();
```

> **ï¼Tips**ï¼šå½“æˆ‘ä»¬éœ€è¦æ“ä½œæŸä¸ªDOMæ—¶ï¼Œå¯ä»¥å°†å…¶å…‹éš†è¿›æ–‡æœ¬ç‰‡æ®µï¼Œæ‰§è¡Œæ“ä½œä¹‹åå†æŒ‚è½½åˆ°å…ƒç´ ä¸Šå³å¯ï¼Œè¿™æ ·å¯ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œæ¯”å¦‚ Vue æ¨¡æ¿ç¼–è¯‘åŸç†å°±æ˜¯ä½¿ç”¨æ–‡æœ¬ç‰‡æ®µæ“ä½œDOMçš„ã€‚

```js
function nodeToFragment(el) {
  // 1. åˆ›å»º fragment å¯¹è±¡
  const fragment = document.createDocumentFragment();
  const child;
  // 2. å°†åŸç”ŸèŠ‚ç‚¹ç§»åŠ¨åˆ°fragmentä¸­
  while ((child = el.firstChild)) {
    fragment.appendChild(child);
  }
  // 3. è¿”å› fragment
  return fragment;
}
```

## æ“ä½œå±æ€§

```js
// 1. è®¾ç½®ã€ä¿®æ”¹ã€è¯»å–å±æ€§ *
el.setAttribute("href", "https://github.com/lihongyao");
el.setAttribute("target", "_blank");
el.getAttribute("href");
// 2. åˆ¤æ–­æŒ‡å®šå±æ€§æ˜¯å¦å­˜åœ¨ *
el.hasAttribute("href");
// 3. ç§»é™¤æŒ‡å®šå±æ€§ *
el.removeAttribute("target");
// 4. è·å–æ‰€æœ‰å±æ€§
el.attributes;
// 5. æ·»åŠ è‡ªå®šä¹‰å±æ€§â€œdata-*â€ *
el.dataset.desc = "è€€å“¥åšå®¢åœ°å€";
```

## æ“ä½œç±»å

```js
// 1. é€šè¿‡classnameæ“ä½œç±»å *
// - è®¾ç½®ç±»å
el.className = "link"; 
el.className = "link blog";
// - è®¿é—®ç±»å
el.className;
// - ç§»é™¤ç±»å
el.className = "";

// 2. é€šè¿‡classListæ“ä½œç±»å 
// - æ·»åŠ ç±»å *
el.classList.add("link");
el.classList.add("flag");
// - ç§»é™¤ç±»å *
el.classList.remove("flag");
// - æŸ¥è¯¢æ˜¯å¦åŒ…å«æŸä¸ªç±»å *
el.classList.contains("link"); // true
// - æŸ¥è¯¢æŒ‡å®šä½ç½®çš„ç±»å
el.classList.item(0); // link
// - å°†ç±»åé›†åˆè½¬ä¸ºå­—ç¬¦ä¸²
el.classList.toString();
```

## æ“ä½œå†…å®¹

```js
// 1. textContent
// - è®¾ç½®
el.textContent = "China";
// - è¯»å–
el.textContent 

// 2. innerHTML
// - è®¾ç½®
el.innerHTML = "I love <mark>China</mark>";
// - è¯»å–
el.innerHTML
```

> æç¤ºï¼š`textContent` è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬ï¼Œä¸èƒ½è¯†åˆ« HTMLæ ‡ç­¾ï¼Œè€Œ `innerHTML` å¯ä»¥è¯†åˆ« HTML æ ‡ç­¾ã€‚

## æ’å…¥èŠ‚ç‚¹

```js
// 1. åœ¨æŒ‡å®šå…ƒç´ å†…è¿½åŠ (åé¢)
tag.appendChild(el);
tag.append(el);

// 2. åœ¨æŒ‡å®šå…ƒç´ å†…è¿½åŠ (å‰é¢)
tag.prepend(el)

// 3. åœ¨æŒ‡å®šå…ƒç´ å‰åŠ å…¥
tag.before(el);
tag.insertBefore(el, æŒ‡å®šå…ƒç´ );

// 4. åœ¨æŒ‡å®šå…ƒç´ ååŠ å…¥
tag.after(el);

// 5. åœ¨æŒ‡å®šå…ƒç´ çš„æŒ‡å®šä½ç½®åŠ å…¥
/*
insertAdjacentHTML
- beforebeginï¼šåœ¨å½“å‰å…ƒç´ èŠ‚ç‚¹çš„å‰é¢ã€‚
- afterbeginï¼šä½œä¸ºå½“å‰å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ æ’å…¥ã€‚
- afterendï¼šåœ¨å½“å‰å…ƒç´ èŠ‚ç‚¹çš„åé¢ã€‚
- beforeendï¼šä½œä¸ºå½“å‰å…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´ æ’å…¥ã€‚*/
tag.insertAdjacentHTML("beforeend", "<h1>æ–°æ’å…¥çš„èŠ‚ç‚¹</h1>");
```

> æç¤ºï¼š`insertAdjacentHTML` æ–¹æ³•å¯ä»¥è¯†åˆ« `html` æ ‡ç­¾ã€‚

## æ“ä½œæ ·å¼

```js
// 1. é€ä¸€èµ‹å€¼
el.style.color = "orange";
el.style.fontStyle = "italic";
el.style.letterSpacing = "8px";

// 2. ç»Ÿä¸€èµ‹å€¼
el.style.cssText = "color:orange;font-style:italic;letter-spacing:8px;";
```

åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒæŸä¸ªæ ·å¼å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
if(el.style.color == undefined) {
    console.log("ä¸æ”¯æŒcoloræ ·å¼å±æ€§")  
}else {
    console.log("æ”¯æŒcoloræ ·å¼å±æ€§") 
}
```

> æç¤ºï¼šé€šè¿‡è„šæœ¬æ·»åŠ /è¯»å–çš„æ ·å¼æ˜¯è¡Œå†…æ ·å¼ã€‚

## æ›¿æ¢èŠ‚ç‚¹

```js
// 1. ä¸»åŠ¨æ›¿æ¢
tag.replaceWith(el);
// 2. è¢«åŠ¨æ›¿æ¢ï¼ˆé€šè¿‡çˆ¶å…ƒç´ æ›¿æ¢ï¼‰
parent.replaceChild(el, child);
```

## ç§»é™¤èŠ‚ç‚¹

```js
// 1. ä¸»åŠ¨ç§»é™¤
el.remove();

// 2. è¢«åŠ¨ç§»é™¤ï¼ˆé€šè¿‡çˆ¶å…ƒç´ ç§»é™¤ï¼‰
parent.removeChild(el);
```

# è¡¥å……çŸ¥è¯†

```js
// 01. è·å–å…ƒç´ çš„id
el.id;
// 02. è·å–æ ‡ç­¾åç§°
el.tagName;
// 03. è·å–å†…éƒ¨æ ‡ç­¾ç»“æ„ï¼ˆä¸åŒ…æ‹¬è‡ªèº«ï¼‰
el.innerHTML;
// 04. è·å–å†…éƒ¨æ ‡ç­¾ç»“æ„ï¼ˆåŒ…æ‹¬è‡ªèº«ï¼‰
el.outerHTML;
// 05. è¡¨å•å…ƒç´ è·å–ç„¦ç‚¹
el.focus();
// 06. æ»šåŠ¨å½“å‰å…ƒç´ ï¼Œè¿›å…¥æµè§ˆå™¨çš„å¯è§åŒºåŸŸï¼Œå‚æ•°trueé¡¶éƒ¨å¯¹é½ï¼Œfalseåº•éƒ¨å¯¹é½
el.scrollIntoView();
// 07. æ˜¯å¦åŒ…å«å­èŠ‚ç‚¹
el.hasChildNodes();
// 08. å…‹éš†èŠ‚ç‚¹ï¼Œå‚æ•°trueï¼Œå­èŠ‚ç‚¹åŒæ—¶å…‹éš†
el.cloneNode();
// 09. æ˜¯å¦åŒ…å«æŸä¸ªå­èŠ‚ç‚¹
el.contains();
// 10. åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸ç­‰
el.isEqualNode();
```

# è¡¨å•æ“ä½œ

```js
// 1. è·å–è¾“å…¥æ¡†è¾“å…¥çš„å€¼
input.value

// 2. è·å–å•é€‰å€¼
radio.onchange = function() {
  console.log(this.value);
}

// 3. è·å–selecté€‰ä¸­å€¼
// - å•é€‰
select.value
// - å¤šé€‰
select.selectedOptions
```

# æ‹“å±•çŸ¥è¯†

## è·å–éè¡Œé—´æ ·å¼ *

```javascript
function getStyle(el, attr) {
	// å…¼å®¹IE
	if (el.currentStyle) {
		return el.currentStyle[attr];
	}else {
		return getComputedStyle(el, null)[attr];
	}
}
```

## åŠ¨æ€åŠ è½½é¡µé¢å…ƒç´  *

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŠ¨æ€åŠ è½½é¡µé¢å…ƒç´ ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨htmlé¡µé¢ä¸­å‡†å¤‡ä¸€ä¸ªå®¹å™¨ï¼Œæ¯”å¦‚åˆ—è¡¨ï¼š

```html
<ul class="list"></ul>
```

ç„¶ååœ¨è„šæœ¬ä¸­æ ¹æ®æ•°æ®åŠ¨æ€åŠ è½½`li`æ ‡ç­¾å¹¶æ·»åŠ è‡³`ul`åˆ—è¡¨å†…éƒ¨ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š

```js
// 1. æ•°æ®å°è£…ï¼ˆæ¨¡æ‹Ÿåå°è¿”å›çš„æ•°æ®ç»“æ„ï¼‰
const data = [
  { name: "æç™½", position: "åˆºå®¢", skill: "é’è²å‰‘æ­Œ", exp: 500 },
  { name: "è²‚è‰", position: "åˆºå®¢/æ³•å¸ˆ", skill: "ç»½Â·é£å", exp: 350 },
  { name: "é²ç­", position: "å°„æ‰‹", skill: "ç©ºä¸­æ”¯æ´", exp: 800 }
];

// 2. è·å–å®¹å™¨
var list = document.querySelector(".list");
// 3. éå†æ•°æ®æ‹¼æ¥liæ ‡ç­¾
var htmlStr = "";
data.forEach(function(hero) {
    htmlStr += `<li>
        <p class="name">è‹±é›„ï¼š${hero.name}</p>
        <p class="position">å®šä½ï¼š${hero.position}</p>
        <p class="skill">æŠ€èƒ½ï¼š${hero.skill}</p>
        <p class="exp">ç†Ÿç»ƒåº¦ï¼š${hero.exp}</p>
    </li>`
})
// 4. å°†æ‹¼å‡ºæ¥çš„æ ‡ç­¾å‘ˆç°åœ¨é¡µé¢ä¸Š
list.innerHTML = htmlStr;
```

## DOM æ€§èƒ½ä¼˜åŒ– *

[å‚è€ƒ >>](https://feclub.cn/post/content/dom)

é€šè¿‡jsæ“ä½œDOMçš„ä»£ä»·å¾ˆé«˜ï¼Œå½±å“é¡µé¢æ€§èƒ½çš„ä¸»è¦é—®é¢˜æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š

- è®¿é—®å’Œä¿®æ”¹DOMå…ƒç´ ï¼›
- ä¿®æ”¹DOMå…ƒç´ çš„æ ·å¼ï¼Œå¯¼è‡´ **é‡ç»˜** æˆ– **é‡æ’**ï¼›
- é€šè¿‡å¯¹DOMå…ƒç´ çš„äº‹ä»¶å¤„ç†ï¼Œå®Œæˆä¸ç”¨æˆ·çš„äº¤äº’åŠŸèƒ½ï¼›

> **é‡ç»˜**ï¼šä¸€äº›æ ·å¼çš„ä¿®æ”¹ï¼Œå…ƒç´ çš„ä½ç½®å’Œå°ºå¯¸éƒ½æ²¡æœ‰æ”¹å˜ã€‚

> **é‡æ’**ï¼šå…ƒç´ çš„ä½ç½®æˆ–å°ºå¯¸å‘ç”Ÿäº†å˜åŒ–ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—æ¸²æŸ“æ ‘ï¼Œè€Œæ–°çš„æ¸²æŸ“æ ‘å»ºç«‹åï¼Œæµè§ˆå™¨ä¼šé‡æ–°ç»˜åˆ¶å—å½±å“çš„å…ƒç´ ã€‚

é¡µé¢é‡ç»˜çš„é€Ÿåº¦è¦æ¯”é¡µé¢é‡æ’çš„é€Ÿåº¦å¿«ï¼Œåœ¨é¡µé¢äº¤äº’ä¸­è¦å°½é‡é¿å…é¡µé¢çš„é‡æ’æ“ä½œã€‚æµè§ˆå™¨ä¸ä¼šåœ¨jsæ‰§è¡Œçš„æ—¶å€™æ›´æ–°DOMï¼Œè€Œæ˜¯ä¼šæŠŠè¿™äº›DOMæ“ä½œå­˜æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåœ¨jsæ‰§è¡Œå®Œä¹‹åæŒ‰é¡ºåºä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤åœ¨jsæ‰§è¡Œè¿‡ç¨‹ä¸­ç”¨æˆ·ä¸€ç›´åœ¨è¢«é˜»å¡ã€‚

### é¡µé¢æ¸²æŸ“è¿‡ç¨‹

ä¸€ä¸ªé¡µé¢æ›´æ–°æ—¶ï¼Œæ¸²æŸ“è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

![](./IMGS/page_renders.jpeg)

- JavaScriptï¼šé€šè¿‡jsæ¥åˆ¶ä½œåŠ¨ç”»æ•ˆæœæˆ–æ“ä½œDOMå®ç°äº¤äº’æ•ˆæœ
- Styleï¼šè®¡ç®—æ ·å¼ï¼Œå¦‚æœå…ƒç´ çš„æ ·å¼æœ‰æ”¹å˜ï¼Œåœ¨è¿™ä¸€æ­¥é‡æ–°è®¡ç®—æ ·å¼ï¼Œå¹¶åŒ¹é…åˆ°å¯¹åº”çš„DOMä¸Š
- Layoutï¼šæ ¹æ®ä¸Šä¸€æ­¥çš„DOMæ ·å¼è§„åˆ™ï¼Œé‡æ–°è¿›è¡Œå¸ƒå±€ï¼ˆ**é‡æ’**ï¼‰
- Paintï¼šåœ¨å¤šä¸ªæ¸²æŸ“å±‚ä¸Šï¼Œå¯¹æ–°çš„å¸ƒå±€é‡æ–°ç»˜åˆ¶ï¼ˆ**é‡ç»˜**ï¼‰
- Compositeï¼šå°†ç»˜åˆ¶å¥½çš„å¤šä¸ªæ¸²æŸ“å±‚åˆå¹¶ï¼Œæ˜¾ç¤ºåˆ°å±å¹•ä¸Š

åœ¨ç½‘é¡µç”Ÿæˆçš„æ—¶å€™ï¼Œè‡³å°‘ä¼šè¿›è¡Œä¸€æ¬¡å¸ƒå±€å’Œæ¸²æŸ“ï¼Œåœ¨åé¢ç”¨æˆ·çš„æ“ä½œæ—¶ï¼Œä¸æ–­çš„è¿›è¡Œé‡ç»˜æˆ–é‡æ’ï¼Œå› æ­¤å¦‚æœåœ¨jsä¸­å­˜åœ¨å¾ˆå¤šDOMæ“ä½œï¼Œå°±ä¼šä¸æ–­åœ°è§¦å‘é‡ç»˜æˆ–é‡æ’ï¼Œå½±å“é¡µé¢æ€§èƒ½ã€‚

### DOMæ“ä½œå¯¹é¡µé¢æ€§èƒ½çš„å½±å“

DOM æ“ä½œä¼šå½±å“é¡µé¢æ€§èƒ½ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒä¼šå¯¼è‡´ **é‡ç»˜** æˆ– **é‡æ’**ã€‚ä¸ºäº†å‡å°‘è¿™äº›å½±å“ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å“ªäº›æ“ä½œä¼šè§¦å‘é‡ç»˜å’Œé‡æ’ã€‚

> **1ï¼‰å¯¼è‡´é¡µé¢é‡æ’çš„æ“ä½œ**

- **å†…å®¹å˜åŒ–**
  - ä¾‹å¦‚ï¼Œæ–‡æœ¬å†…å®¹å˜åŒ–æˆ–å›¾ç‰‡å°ºå¯¸æ”¹å˜
- **å…ƒç´ å‡ ä½•å±æ€§å˜åŒ–**
  - æ”¹å˜å…ƒç´ çš„å®½é«˜æ—¶ï¼Œæµè§ˆå™¨ä¼šé‡æ–°è®¡ç®—å¹¶æ›´æ–°ç›¸å…³èŠ‚ç‚¹çš„ä½ç½®ï¼Œå½±å“æ•´ä¸ªæ¸²æŸ“æ ‘ã€‚
- **DOM æ ‘ç»“æ„å˜åŒ–**
  - æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹èŠ‚ç‚¹ä¼šå¯¼è‡´æ•´ä¸ª DOM æ ‘çš„é‡æ’ã€‚å¦‚æœåœ¨å·²æœ‰èŠ‚ç‚¹å‰æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œåç»­æ‰€æœ‰å…ƒç´ éƒ½éœ€è¦é‡æ–°æ’ç‰ˆã€‚
- **è·å–æŸäº›å±æ€§**
  - è·å–å¦‚ offsetTopã€offsetLeftã€offsetWidth ç­‰å±æ€§æ—¶ï¼Œæµè§ˆå™¨éœ€è¦é‡æ’ä»¥è®¡ç®—è¿™äº›å€¼ã€‚
- **æµè§ˆå™¨çª—å£å°ºå¯¸å˜åŒ–**
  - æ”¹å˜çª—å£å¤§å°ä¼šå¯¼è‡´é¡µé¢ä¸­å…ƒç´ å°ºå¯¸è°ƒæ•´ï¼Œè¿›è€Œè§¦å‘é‡æ’ã€‚

> **2ï¼‰å¯¼è‡´é¡µé¢é‡ç»˜çš„æ“ä½œ**

- **æ ·å¼æ”¹å˜**
  - ä¿®æ”¹å½±å“å¤–è§‚çš„æ ·å¼ï¼ˆå¦‚ colorã€backgroundï¼‰ï¼Œä¸ä¼šæ”¹å˜å…ƒç´ çš„ä½ç½®æˆ–å¤§å°ï¼Œåªæœ‰é‡ç»˜å‘ç”Ÿã€‚
- **é‡æ’ä¼šè§¦å‘é‡ç»˜**
  - æ¯æ¬¡é‡æ’éƒ½ä¼šå¯¼è‡´æ¸²æŸ“æ ‘çš„å˜åŒ–ï¼Œè¿›è€Œè§¦å‘é‡ç»˜ã€‚

### é«˜é¢‘æ“ä½œDOMä¼šå¯¼è‡´çš„é—®é¢˜

æ¥ä¸‹æ¥ä¼šåˆ†äº«ä¸€ä¸‹åœ¨å¹³æ—¶é¡¹ç›®ä¸­ç”±äºé«˜é¢‘æ“ä½œDOMå½±å“ç½‘é¡µæ€§èƒ½çš„é—®é¢˜ã€‚

#### å¸é¡¶å¯¼èˆªæ¡ç›¸å…³åŠscrollæ»šåŠ¨ä¼˜åŒ–

**1ï¼‰å­˜åœ¨çš„é—®é¢˜**

å¸é¡¶å¯¼èˆªæ¡è¦æ±‚å½“é¡µé¢æ»šåŠ¨åˆ°æŸä¸ªåŒºåŸŸæ—¶ï¼Œå¯¹åº”è¯¥åŒºåŸŸçš„å¯¼èˆªæ¡åœ¨è®¾ç½®çš„æ˜¾ç¤ºèŒƒå›´å†…ä¿æŒå¸é¡¶æ˜¾ç¤ºã€‚æ¶‰åŠåˆ°çš„æ“ä½œï¼š

- ç›‘å¬é¡µé¢çš„scrolläº‹ä»¶
- åœ¨é¡µé¢æ»šåŠ¨æ—¶è¿›è¡Œè®¡ç®—å’ŒDOMæ“ä½œ
  - è®¡ç®—ï¼šè®¡ç®—å½“å‰æ‰€åœ¨ä½ç½®æ˜¯å¦ä¸ºå¯¹åº”å¯¼èˆªæ¡çš„æ˜¾ç¤ºèŒƒå›´
  - DOMæ“ä½œï¼šæ˜¾ç¤ºåœ¨èŒƒå›´å†…çš„å¯¼èˆªæ¡å¹¶ä¸”éšè—å…¶ä»–å¯¼èˆªæ¡

ç”±äºscrolläº‹ä»¶è¢«è§¦å‘çš„é¢‘ç‡é«˜ã€é—´éš”è¿‘ï¼Œå¦‚æœæ­¤æ—¶è¿›è¡ŒDOMæ“ä½œæˆ–è®¡ç®—å¹¶ä¸”è¿™äº›DOMæ“ä½œå’Œè®¡ç®—æ— æ³•åœ¨ä¸‹ä¸€æ¬¡scrolläº‹ä»¶å‘ç”Ÿå‰å®Œæˆï¼Œå°±ä¼šé€ æˆæ‰å¸§ã€é¡µé¢å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

**2ï¼‰ä¼˜åŒ–æ–¹æ¡ˆ**

é’ˆå¯¹è¯¥é¡¹ç›®ä¸­çš„é—®é¢˜ï¼Œé‡‡å–çš„è§£å†³æ–¹æ³•æ˜¯ï¼š

- å°½é‡æ§åˆ¶DOMçš„æ˜¾ç¤ºæˆ–éšè—ï¼Œè€Œä¸æ˜¯åˆ é™¤æˆ–æ·»åŠ ï¼š

  é¡µé¢åŠ è½½æ—¶æ ¹æ®å½“å‰é¡µé¢ä¸­å¸é¡¶å¯¼èˆªçš„æ•°é‡å¤åˆ¶å¯¹åº”çš„DOMï¼Œå¹¶ä¸”éšè—è¿™äº›å¯¼èˆªã€‚å½“é¡µé¢æ»šåŠ¨åˆ°æŒ‡å®šåŒºåŸŸåï¼Œæ˜¾ç¤ºå¯¹åº”çš„å¯¼èˆªã€‚

- ä¸€æ¬¡æ€§æ“ä½œDOMï¼š

  å°†å¤åˆ¶çš„DOMå­˜å‚¨åˆ°æ•°ç»„ä¸­ï¼Œå°†è¯¥æ•°ç»„ append åˆ°å¯¹åº”çš„çˆ¶èŠ‚ç‚¹ä¸‹ï¼Œè€Œä¸æ˜¯æ ¹æ®å¤åˆ¶å¾—åˆ°DOMçš„æ•°é‡ä¾æ¬¡å¾ªç¯æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹ä¸‹ã€‚

- å¤šåšç¼“å­˜

  å¦‚æœæŸä¸ªèŠ‚ç‚¹å°†åœ¨åç»­è¿›è¡Œå¤šæ¬¡æ“ä½œï¼Œå¯ä»¥å°†è¯¥èŠ‚ç‚¹åˆ©ç”¨å˜é‡å­˜å‚¨èµ·æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¿›è¡Œæ“ä½œæ—¶éƒ½å»æŸ¥æ‰¾ä¸€éè¯¥èŠ‚ç‚¹ã€‚

- ä½¿ç”¨ `requestAnimationFrame` ä¼˜åŒ–é¡µé¢æ»šåŠ¨ï¼š

  ```javascript
  // åœ¨é¡µé¢æ»šåŠ¨æ—¶å¯¹æ˜¾ç¤ºèŒƒå›´è¿›è¡Œè®¡ç®—
  // å»¶è¿Ÿåˆ°æ•´ä¸ªdomåŠ è½½å®Œåå†è°ƒç”¨ï¼Œå¹¶ä¸”å¼‚æ­¥åˆ°æ‰€æœ‰äº‹ä»¶åæ‰§è¡Œ
  $(function () {
    // animationShow ä¼˜åŒ–æ»šåŠ¨æ•ˆæœï¼ŒscrollShow ä¸ºå®é™…è®¡ç®—æ˜¾ç¤ºèŒƒå›´åŠæ“ä½œDOMçš„å‡½æ•°
    setTimeout(function () {
      window.Scroller.on('scrollend', animationShow);
      window.Scroller.on('scrollmove', animationShow);
    });
  });
  function animationShow() {
    return window.requestAnimationFrame
      ? window.requestAnimationFrame(scrollShow)
      : scrollShow();
  }
  ```

> å¯¹äºscrollçš„æ»šåŠ¨ä¼˜åŒ–è¿˜å¯ä»¥é‡‡ç”¨é˜²æŠ–ï¼ˆDebouncingï¼‰å’ŒèŠ‚æµï¼ˆThrottlingï¼‰çš„æ–¹å¼ï¼Œä½†æ˜¯é˜²æŠ–å’ŒèŠ‚æµçš„æ–¹å¼è¿˜æ˜¯è¦å€ŸåŠ©äºsetTimeoutï¼Œå› æ­¤å’ŒrequestAnimationFrameç›¸æ¯”ï¼Œè¿˜æ˜¯requestAnimationFrameå®ç°æ•ˆæœå¥½ä¸€äº›ã€‚

### æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

- å‡å°‘åœ¨å¾ªç¯å†…è¿›è¡ŒDOMæ“ä½œï¼Œåœ¨å¾ªç¯å¤–éƒ¨è¿›è¡ŒDOMç¼“å­˜
  - é¿å…ä½¿ç”¨ +=ï¼Œå°†æ‹¼æ¥å…ƒç´ æ”¾å…¥æ•°ç»„é€šè¿‡ `join()` æ–¹æ³•æ•ˆç‡æ›´é«˜
- åªæ§åˆ¶DOMèŠ‚ç‚¹çš„æ˜¾ç¤ºæˆ–éšè—ï¼Œè€Œä¸æ˜¯ç›´æ¥å»æ”¹å˜DOMç»“æ„
- æ“ä½œDOMå‰ï¼Œå…ˆæŠŠDOMèŠ‚ç‚¹åˆ é™¤æˆ–éšè—
- æœ€å°åŒ–é‡ç»˜å’Œé‡æ’
  - é€šè¿‡ç±»åæ›´æ–°æ ·å¼

## CSS åŠ¨ç”» ğŸ†š JSåŠ¨ç”»

> `CSS` åŠ¨ç”»

ä¼˜åŠ¿ï¼š

- **ç¡¬ä»¶åŠ é€Ÿ**ï¼šé€šè¿‡æµè§ˆå™¨çš„ GPU æé«˜åŠ¨ç”»æ€§èƒ½ã€‚
- **ç®€æ´ä»£ç **ï¼šå®ç°ç®€å•åŠ¨ç”»æ—¶ï¼Œä»£ç è¾ƒä¸ºç®€æ´ã€‚
- **è‡ªç„¶é™çº§**ï¼šä½ç‰ˆæœ¬æµè§ˆå™¨è‡ªåŠ¨é™çº§ï¼Œé¿å…é¢å¤–çš„å…¼å®¹æ€§å¤„ç†ã€‚

åŠ£åŠ¿ï¼š

- **å®ç°å¤æ‚æ•ˆæœæ—¶è¾ƒç¬¨é‡**ï¼šå¤æ‚åŠ¨ç”»éš¾ä»¥ç”¨çº¯ CSS å®ç°ï¼Œä»£ç å†—é•¿ã€‚
- **å…¼å®¹æ€§é—®é¢˜**ï¼šæŸäº›æµè§ˆå™¨å¯èƒ½ä¸å®Œå…¨æ”¯æŒ CSS3 åŠ¨ç”»ã€‚
- **æ§åˆ¶èƒ½åŠ›å¼±**ï¼šæ— æ³•ç²¾ç¡®æ§åˆ¶åŠ¨ç”»ï¼Œå¦‚æš‚åœã€ç‰¹å®šæ—¶åˆ»åè½¬ã€è°ƒæ•´æ—¶é—´å°ºåº¦æˆ–æ·»åŠ å›è°ƒå‡½æ•°ã€‚

> `JavaScript` åŠ¨ç”»

ä¼˜åŠ¿ï¼š

- **çµæ´»æ§åˆ¶**ï¼šå¯ä»¥åŠ¨æ€æ§åˆ¶åŠ¨ç”»çš„å¼€å§‹ã€æš‚åœã€å›æ”¾ã€ç»ˆæ­¢ç­‰ã€‚
- **ä¸°å¯Œæ•ˆæœ**ï¼šæ”¯æŒæ›´å¤šå¤æ‚æ•ˆæœï¼ˆå¦‚æ›²çº¿ã€è§†å·®æ»šåŠ¨ç­‰ï¼‰ã€‚
- **å…¼å®¹æ€§å¥½**ï¼šä¸æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜è¾ƒå°‘ã€‚

åŠ£åŠ¿ï¼š

- **ä¸»çº¿ç¨‹é˜»å¡**ï¼šç”±äºåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´ä¸¢å¸§æˆ–å¡é¡¿ã€‚
- **ä»£ç å¤æ‚åº¦é«˜**ï¼šéœ€è¦ç¼–å†™æ›´å¤šçš„ä»£ç æ¥å®ç°åŠ¨ç”»æ•ˆæœå’Œæ§åˆ¶ã€‚

# [MutationObserver](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver)

æ¥å£æä¾›äº†ç›‘è§†å¯¹DOMæ ‘æ‰€åšæ›´æ”¹çš„èƒ½åŠ›ã€‚

## API

[`disconnect()`](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/disconnect)

`é˜»æ­¢ MutationObserver` å®ä¾‹ç»§ç»­æ¥æ”¶çš„é€šçŸ¥ï¼Œç›´åˆ°å†æ¬¡è°ƒç”¨å…¶[`observe()`](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe)æ–¹æ³•ï¼Œè¯¥è§‚å¯Ÿè€…å¯¹è±¡åŒ…å«çš„å›è°ƒå‡½æ•°éƒ½ä¸ä¼šå†è¢«è°ƒç”¨ã€‚

[`observe()`](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe)

é…ç½®`MutationObserver`åœ¨DOMæ›´æ”¹åŒ¹é…ç»™å®šé€‰é¡¹æ—¶ï¼Œé€šè¿‡å…¶å›è°ƒå‡½æ•°å¼€å§‹æ¥æ”¶é€šçŸ¥ã€‚

[`takeRecords()`](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/takeRecords)

ä»MutationObserverçš„é€šçŸ¥é˜Ÿåˆ—ä¸­åˆ é™¤æ‰€æœ‰å¾…å¤„ç†çš„é€šçŸ¥ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ°[`MutationRecord`](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationRecord)å¯¹è±¡çš„æ–°[`Array`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array)ä¸­ã€‚

## ç¤ºä¾‹

```js
// é€‰æ‹©éœ€è¦è§‚å¯Ÿå˜åŠ¨çš„èŠ‚ç‚¹
const targetNode = document.getElementById('some-id');

// è§‚å¯Ÿå™¨çš„é…ç½®ï¼ˆéœ€è¦è§‚å¯Ÿä»€ä¹ˆå˜åŠ¨ï¼‰
const config = { attributes: true, childList: true, subtree: true };

// å½“è§‚å¯Ÿåˆ°å˜åŠ¨æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°
const callback = function(mutationsList, observer) {
    // Use traditional 'for loops' for IE 11
    for(let mutation of mutationsList) {
        if (mutation.type === 'childList') {
            console.log('A child node has been added or removed.');
        }
        else if (mutation.type === 'attributes') {
            console.log('The ' + mutation.attributeName + ' attribute was modified.');
        }
    }
};

// åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿå™¨å®ä¾‹å¹¶ä¼ å…¥å›è°ƒå‡½æ•°
const observer = new MutationObserver(callback);

// ä»¥ä¸Šè¿°é…ç½®å¼€å§‹è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹
observer.observe(targetNode, config);

// ä¹‹åï¼Œå¯åœæ­¢è§‚å¯Ÿ
observer.disconnect();
```















